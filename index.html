
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hockey Goalie Fitness Trainer</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f3f4f6;
            color: #1f2937;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 1rem;
        }
        
        .header {
            background: linear-gradient(135deg, #2563eb, #1d4ed8);
            color: white;
            padding: 2rem;
            border-radius: 12px;
            margin-bottom: 2rem;
            text-align: center;
        }
        
        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }
        
        .stat-card {
            background: white;
            padding: 1.5rem;
            border-radius: 12px;
            text-align: center;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .stat-number {
            font-size: 2rem;
            font-weight: bold;
            margin-bottom: 0.5rem;
        }
        
        .workout-card {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .workout-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 16px rgba(0,0,0,0.15);
        }
        
        .workout-card.active {
            border: 2px solid #2563eb;
            background: #eff6ff;
        }
        
        .workout-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }
        
        .workout-title {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }
        
        .workout-emoji {
            font-size: 2rem;
        }
        
        .workout-name {
            font-size: 1.25rem;
            font-weight: bold;
        }
        
        .workout-description {
            color: #6b7280;
            font-size: 0.9rem;
        }
        
        .progress-bar {
            background: #e5e7eb;
            height: 8px;
            border-radius: 4px;
            overflow: hidden;
            margin: 1rem 0;
        }
        
        .progress-fill {
            height: 100%;
            background: #10b981;
            transition: width 0.3s ease;
        }
        
        .exercise-list {
            display: none;
            margin-top: 1rem;
        }
        
        .exercise-list.show {
            display: block;
        }
        
        .exercise-item {
            display: flex;
            align-items: center;
            padding: 1rem;
            margin: 0.5rem 0;
            background: #f9fafb;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .exercise-item:hover {
            background: #f3f4f6;
        }
        
        .exercise-item.completed {
            background: #ecfdf5;
            border: 1px solid #10b981;
        }
        
        .exercise-checkbox {
            width: 24px;
            height: 24px;
            border: 2px solid #d1d5db;
            border-radius: 50%;
            margin-right: 1rem;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: white;
            background: #9ca3af;
        }
        
        .exercise-item.completed .exercise-checkbox {
            background: #10b981;
            border-color: #10b981;
        }
        
        .exercise-info {
            flex-grow: 1;
        }
        
        .exercise-name {
            font-weight: 600;
            margin-bottom: 0.25rem;
        }
        
        .exercise-reps {
            color: #6b7280;
            font-size: 0.9rem;
        }
        
        .exercise-xp {
            background: #fef3c7;
            color: #d97706;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            font-size: 0.8rem;
            font-weight: bold;
        }
        
        .button {
            background: #2563eb;
            color: white;
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: background 0.2s;
        }
        
        .button:hover {
            background: #1d4ed8;
        }
        
        .button-small {
            padding: 0.5rem 1rem;
            font-size: 0.9rem;
        }
        
        .achievements {
            background: white;
            padding: 2rem;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .achievement-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
        }
        
        .achievement-item {
            display: flex;
            align-items: center;
            padding: 1rem;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            gap: 0.75rem;
        }
        
        .achievement-item.unlocked {
            border-color: #fbbf24;
            background: #fffbeb;
        }
        
        .achievement-emoji {
            font-size: 2rem;
        }
        
        .achievement-info h4 {
            font-weight: bold;
            margin-bottom: 0.25rem;
        }
        
        .achievement-info p {
            color: #6b7280;
            font-size: 0.9rem;
        }
        
        .level-badge {
            background: #fbbf24;
            color: #92400e;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-weight: bold;
            font-size: 1.1rem;
        }
        
        .xp-progress {
            margin-top: 0.5rem;
            color: #fbbf24;
            font-size: 0.9rem;
        }
        
        @media (max-width: 768px) {
            .header h1 {
                font-size: 2rem;
            }
            
            .workout-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 1rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>ü•Ö Goalie Fitness Trainer</h1>
            <p>Become the ultimate hockey goalie</p>
            <div style="margin-top: 1rem;">
                <span class="level-badge" id="levelBadge">Level 1</span>
                <div class="xp-progress" id="xpProgress">0 XP (500 to next level)</div>
            </div>
        </div>

        <!-- Stats -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-number" style="color: #f97316;" id="streakCount">0</div>
                <div>üî• Day Streak</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" style="color: #eab308;" id="achievementCount">0</div>
                <div>üèÜ Achievements</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" style="color: #10b981;" id="exerciseCount">0</div>
                <div>üìà Exercises Done</div>
            </div>
        </div>

        <!-- Workout Schedule -->
        <div class="workout-schedule">
            <h2 style="margin-bottom: 1.5rem; font-size: 1.8rem;">Weekly Training Schedule</h2>
            
            <div class="workout-card" data-day="monday">
                <div class="workout-header">
                    <div class="workout-title">
                        <span class="workout-emoji">ü¶µ</span>
                        <div>
                            <div class="workout-name">Monday</div>
                            <div class="workout-description">Lower Body & Hip Mobility</div>
                        </div>
                    </div>
                    <button class="button button-small" onclick="toggleWorkout('monday')">Start Workout</button>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" id="progress-monday" style="width: 0%"></div>
                </div>
                <div style="margin-top: 0.5rem; color: #6b7280; font-size: 0.9rem;">
                    <span id="completion-monday">0% Complete (0/13 exercises)</span>
                    <span style="float: right; color: #2563eb; font-weight: bold;">
                        <span id="xp-monday">0</span>/<span id="xp-target-monday">0</span> XP
                    </span>
                </div>
                
                <div class="exercise-list" id="exercises-monday">
                    <div class="exercise-item" onclick="toggleExercise('monday', 0)">
                        <div class="exercise-checkbox">1</div>
                        <div class="exercise-info">
                            <div class="exercise-name">Leg Swings</div>
                            <div class="exercise-reps">10 each direction/leg</div>
                        </div>
                        <div class="exercise-xp">15 XP</div>
                    </div>
                    <div class="exercise-item" onclick="toggleExercise('monday', 1)">
                        <div class="exercise-checkbox">2</div>
                        <div class="exercise-info">
                            <div class="exercise-name">Hip Circles</div>
                            <div class="exercise-reps">10 each direction</div>
                        </div>
                        <div class="exercise-xp">15 XP</div>
                    </div>
                    <div class="exercise-item" onclick="toggleExercise('monday', 2)">
                        <div class="exercise-checkbox">3</div>
                        <div class="exercise-info">
                            <div class="exercise-name">Bodyweight Squats</div>
                            <div class="exercise-reps">15 reps</div>
                        </div>
                        <div class="exercise-xp">20 XP</div>
                    </div>
                    <div class="exercise-item" onclick="toggleExercise('monday', 3)">
                        <div class="exercise-checkbox">4</div>
                        <div class="exercise-info">
                            <div class="exercise-name">Walking Lunges</div>
                            <div class="exercise-reps">10 each leg</div>
                        </div>
                        <div class="exercise-xp">20 XP</div>
                    </div>
                    <div class="exercise-item" onclick="toggleExercise('monday', 4)">
                        <div class="exercise-checkbox">5</div>
                        <div class="exercise-info">
                            <div class="exercise-name">Goblet Squats</div>
                            <div class="exercise-reps">12-15 reps √ó 3 sets</div>
                        </div>
                        <div class="exercise-xp">25 XP</div>
                    </div>
                    <div class="exercise-item" onclick="toggleExercise('monday', 5)">
                        <div class="exercise-checkbox">6</div>
                        <div class="exercise-info">
                            <div class="exercise-name">Single-Leg Romanian Deadlifts</div>
                            <div class="exercise-reps">8 each leg √ó 3 sets</div>
                        </div>
                        <div class="exercise-xp">25 XP</div>
                    </div>
                    <div class="exercise-item" onclick="toggleExercise('monday', 6)">
                        <div class="exercise-checkbox">7</div>
                        <div class="exercise-info">
                            <div class="exercise-name">Lateral Lunges</div>
                            <div class="exercise-reps">10 each side √ó 3 sets</div>
                        </div>
                        <div class="exercise-xp">25 XP</div>
                    </div>
                    <div class="exercise-item" onclick="toggleExercise('monday', 7)">
                        <div class="exercise-checkbox">8</div>
                        <div class="exercise-info">
                            <div class="exercise-name">Glute Bridges</div>
                            <div class="exercise-reps">15 reps √ó 3 sets</div>
                        </div>
                        <div class="exercise-xp">20 XP</div>
                    </div>
                    <div class="exercise-item" onclick="toggleExercise('monday', 8)">
                        <div class="exercise-checkbox">9</div>
                        <div class="exercise-info">
                            <div class="exercise-name">Cossack Squats</div>
                            <div class="exercise-reps">6 each side √ó 3 sets</div>
                        </div>
                        <div class="exercise-xp">30 XP</div>
                    </div>
                    <div class="exercise-item" onclick="toggleExercise('monday', 9)">
                        <div class="exercise-checkbox">10</div>
                        <div class="exercise-info">
                            <div class="exercise-name">90/90 Hip Stretch</div>
                            <div class="exercise-reps">1 min each side</div>
                        </div>
                        <div class="exercise-xp">15 XP</div>
                    </div>
                    <div class="exercise-item" onclick="toggleExercise('monday', 10)">
                        <div class="exercise-checkbox">11</div>
                        <div class="exercise-info">
                            <div class="exercise-name">Pigeon Pose</div>
                            <div class="exercise-reps">1 min each side</div>
                        </div>
                        <div class="exercise-xp">15 XP</div>
                    </div>
                    <div class="exercise-item" onclick="toggleExercise('monday', 11)">
                        <div class="exercise-checkbox">12</div>
                        <div class="exercise-info">
                            <div class="exercise-name">Hip Flexor Stretch</div>
                            <div class="exercise-reps">1 min each side</div>
                        </div>
                        <div class="exercise-xp">15 XP</div>
                    </div>
                    <div class="exercise-item" onclick="toggleExercise('monday', 12)">
                        <div class="exercise-checkbox">13</div>
                        <div class="exercise-info">
                            <div class="exercise-name">Deep Squat Hold</div>
                            <div class="exercise-reps">2 minutes</div>
                        </div>
                        <div class="exercise-xp">20 XP</div>
                    </div>
                </div>
            </div>

            <div class="workout-card" data-day="tuesday">
                <div class="workout-header">
                    <div class="workout-title">
                        <span class="workout-emoji">üí™</span>
                        <div>
                            <div class="workout-name">Tuesday</div>
                            <div class="workout-description">Upper Body & Core</div>
                        </div>
                    </div>
                    <button class="button button-small" onclick="toggleWorkout('tuesday')">Start Workout</button>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" id="progress-tuesday" style="width: 0%"></div>
                </div>
                <div style="margin-top: 0.5rem; color: #6b7280; font-size: 0.9rem;">
                    <span id="completion-tuesday">0% Complete (0/13 exercises)</span>
                    <span style="float: right; color: #2563eb; font-weight: bold;">
                        <span id="xp-tuesday">0</span>/<span id="xp-target-tuesday">0</span> XP
                    </span>
                </div>
                
                <div class="exercise-list" id="exercises-tuesday">
                    <div class="exercise-item" onclick="toggleExercise('tuesday', 0)">
                        <div class="exercise-checkbox">1</div>
                        <div class="exercise-info">
                            <div class="exercise-name">Arm Circles</div>
                            <div class="exercise-reps">10 each direction</div>
                        </div>
                        <div class="exercise-xp">10 XP</div>
                    </div>
                    <div class="exercise-item" onclick="toggleExercise('tuesday', 1)">
                        <div class="exercise-checkbox">2</div>
                        <div class="exercise-info">
                            <div class="exercise-name">Shoulder Rolls</div>
                            <div class="exercise-reps">10 backwards</div>
                        </div>
                        <div class="exercise-xp">10 XP</div>
                    </div>
                    <div class="exercise-item" onclick="toggleExercise('tuesday', 2)">
                        <div class="exercise-checkbox">3</div>
                        <div class="exercise-info">
                            <div class="exercise-name">Cat-Cow Stretches</div>
                            <div class="exercise-reps">10 reps</div>
                        </div>
                        <div class="exercise-xp">15 XP</div>
                    </div>
                    <div class="exercise-item" onclick="toggleExercise('tuesday', 3)">
                        <div class="exercise-checkbox">4</div>
                        <div class="exercise-info">
                            <div class="exercise-name">Plank Hold</div>
                            <div class="exercise-reps">30 seconds</div>
                        </div>
                        <div class="exercise-xp">15 XP</div>
                    </div>
                    <div class="exercise-item" onclick="toggleExercise('tuesday', 4)">
                        <div class="exercise-checkbox">5</div>
                        <div class="exercise-info">
                            <div class="exercise-name">Push-ups</div>
                            <div class="exercise-reps">10-15 reps √ó 3 sets</div>
                        </div>
                        <div class="exercise-xp">25 XP</div>
                    </div>
                    <div class="exercise-item" onclick="toggleExercise('tuesday', 5)">
                        <div class="exercise-checkbox">6</div>
                        <div class="exercise-info">
                            <div class="exercise-name">Resistance Band Rows</div>
                            <div class="exercise-reps">15 reps √ó 3 sets</div>
                        </div>
                        <div class="exercise-xp">20 XP</div>
                    </div>
                    <div class="exercise-item" onclick="toggleExercise('tuesday', 6)">
                        <div class="exercise-checkbox">7</div>
                        <div class="exercise-info">
                            <div class="exercise-name">Pike Push-ups</div>
                            <div class="exercise-reps">8-12 reps √ó 3 sets</div>
                        </div>
                        <div class="exercise-xp">25 XP</div>
                    </div>
                    <div class="exercise-item" onclick="toggleExercise('tuesday', 7)">
                        <div class="exercise-checkbox">8</div>
                        <div class="exercise-info">
                            <div class="exercise-name">Face Pulls</div>
                            <div class="exercise-reps">15 reps √ó 3 sets</div>
                        </div>
                        <div class="exercise-xp">20 XP</div>
                    </div>
                    <div class="exercise-item" onclick="toggleExercise('tuesday', 8)">
                        <div class="exercise-checkbox">9</div>
                        <div class="exercise-info">
                            <div class="exercise-name">External Rotations</div>
                            <div class="exercise-reps">12 each arm √ó 3 sets</div>
                        </div>
                        <div class="exercise-xp">20 XP</div>
                    </div>
                    <div class="exercise-item" onclick="toggleExercise('tuesday', 9)">
                        <div class="exercise-checkbox">10</div>
                        <div class="exercise-info">
                            <div class="exercise-name">Dead Bug</div>
                            <div class="exercise-reps">10 each side √ó 2 sets</div>
                        </div>
                        <div class="exercise-xp">20 XP</div>
                    </div>
                    <div class="exercise-item" onclick="toggleExercise('tuesday', 10)">
                        <div class="exercise-checkbox">11</div>
                        <div class="exercise-info">
                            <div class="exercise-name">Side Plank</div>
                            <div class="exercise-reps">30 sec each side √ó 2 sets</div>
                        </div>
                        <div class="exercise-xp">25 XP</div>
                    </div>
                    <div class="exercise-item" onclick="toggleExercise('tuesday', 11)">
                        <div class="exercise-checkbox">12</div>
                        <div class="exercise-info">
                            <div class="exercise-name">Bird Dog</div>
                            <div class="exercise-reps">10 each side √ó 2 sets</div>
                        </div>
                        <div class="exercise-xp">20 XP</div>
                    </div>
                    <div class="exercise-item" onclick="toggleExercise('tuesday', 12)">
                        <div class="exercise-checkbox">13</div>
                        <div class="exercise-info">
                            <div class="exercise-name">Pallof Press</div>
                            <div class="exercise-reps">10 each side √ó 2 sets</div>
                        </div>
                        <div class="exercise-xp">25 XP</div>
                    </div>
                </div>
            </div>

            <!-- Add more days here if needed -->
        </div>

        <!-- Achievements -->
        <div class="achievements">
            <h2 style="margin-bottom: 1rem; font-size: 1.8rem;">üèÜ Achievements</h2>
            <div class="achievement-grid">
                <div class="achievement-item" id="achievement-first">
                    <div class="achievement-emoji">ü•á</div>
                    <div class="achievement-info">
                        <h4>First Steps</h4>
                        <p>Complete your first exercise</p>
                    </div>
                </div>
                <div class="achievement-item" id="achievement-week">
                    <div class="achievement-emoji">‚öîÔ∏è</div>
                    <div class="achievement-info">
                        <h4>Week Warrior</h4>
                        <p>Complete a full week of workouts</p>
                    </div>
                </div>
                <div class="achievement-item" id="achievement-streak">
                    <div class="achievement-emoji">üî•</div>
                    <div class="achievement-info">
                        <h4>Streak Master</h4>
                        <p>Maintain a 7-day streak</p>
                    </div>
                </div>
                <div class="achievement-item" id="achievement-goalie">
                    <div class="achievement-emoji">ü•Ö</div>
                    <div class="achievement-info">
                        <h4>Goalie God</h4>
                        <p>Reach level 10</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const workoutMeta = {};
        const ACHIEVEMENT_DETAILS = {
            first: { elementId: 'achievement-first', message: 'ü•á Achievement Unlocked: First Steps!' },
            week: { elementId: 'achievement-week', message: '‚öîÔ∏è Achievement Unlocked: Week Warrior!' },
            streak: { elementId: 'achievement-streak', message: 'üî• Achievement Unlocked: Streak Master!' },
            goalie: { elementId: 'achievement-goalie', message: 'ü•Ö Achievement Unlocked: Goalie God!' }
        };

        let exerciseData = {};
        let totalXP = 0;
        let level = 1;
        let streak = 0;
        let achievements = [];
        let dayCompletion = {};
        let activityLog = {};
        let weekCompletions = {};
        let currentWeekKey = null;

        function initializeWorkoutMeta() {
            document.querySelectorAll('.workout-card').forEach(card => {
                const day = card.dataset.day;
                if (!day) {
                    return;
                }
                const exerciseItems = card.querySelectorAll('.exercise-item');
                const totalExercises = exerciseItems.length;
                const totalXP = Array.from(exerciseItems).reduce((sum, item) => {
                    const xpElement = item.querySelector('.exercise-xp');
                    const xpValue = xpElement ? parseInt(xpElement.textContent, 10) : 0;
                    return sum + (isNaN(xpValue) ? 0 : xpValue);
                }, 0);
                workoutMeta[day] = { totalExercises, totalXP };

                const targetSpan = document.getElementById(`xp-target-${day}`);
                if (targetSpan) {
                    targetSpan.textContent = totalXP;
                }
            });
        }

        function formatDate(date) {
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            return `${year}-${month}-${day}`;
        }

        function parseDateKey(key) {
            const [year, month, day] = key.split('-').map(Number);
            const parsed = new Date();
            parsed.setFullYear(year, (month || 1) - 1, day || 1);
            parsed.setHours(0, 0, 0, 0);
            return parsed;
        }

        function getTodayKey() {
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            return formatDate(today);
        }

        function getWeekKey(date) {
            const current = new Date(date);
            current.setHours(0, 0, 0, 0);
            const day = current.getDay();
            const diff = day === 0 ? -6 : 1 - day;
            current.setDate(current.getDate() + diff);
            return formatDate(current);
        }

        function addDayToLogs(day, dateKey) {
            if (!dateKey) {
                return;
            }
            if (!activityLog[dateKey]) {
                activityLog[dateKey] = { workouts: [] };
            }
            if (!activityLog[dateKey].workouts.includes(day)) {
                activityLog[dateKey].workouts.push(day);
            }

            const weekKey = getWeekKey(parseDateKey(dateKey));
            if (!weekCompletions[weekKey]) {
                weekCompletions[weekKey] = { workouts: [] };
            }
            if (!weekCompletions[weekKey].workouts.includes(day)) {
                weekCompletions[weekKey].workouts.push(day);
            }
        }

        function removeDayFromLogs(day, dateKey) {
            if (!dateKey) {
                return;
            }
            const log = activityLog[dateKey];
            if (log && Array.isArray(log.workouts)) {
                log.workouts = log.workouts.filter(item => item !== day);
                if (log.workouts.length === 0) {
                    delete activityLog[dateKey];
                }
            }

            const weekKey = getWeekKey(parseDateKey(dateKey));
            const week = weekCompletions[weekKey];
            if (week && Array.isArray(week.workouts)) {
                week.workouts = week.workouts.filter(item => item !== day);
                if (week.workouts.length === 0) {
                    delete weekCompletions[weekKey];
                }
            }
        }

        function syncDayCompletion(day, isComplete) {
            const current = dayCompletion[day] || { isComplete: false, completionDate: null };
            if (current.isComplete === isComplete) {
                return;
            }

            if (isComplete) {
                const todayKey = getTodayKey();
                dayCompletion[day] = { isComplete: true, completionDate: todayKey };
                addDayToLogs(day, todayKey);
            } else {
                if (current.completionDate) {
                    removeDayFromLogs(day, current.completionDate);
                }
                dayCompletion[day] = { isComplete: false, completionDate: null };
            }
        }

        function computeStreak(referenceDate = new Date()) {
            let count = 0;
            const date = new Date(referenceDate);
            date.setHours(0, 0, 0, 0);

            while (true) {
                const key = formatDate(date);
                const log = activityLog[key];
                if (log && Array.isArray(log.workouts) && log.workouts.length > 0) {
                    count += 1;
                    date.setDate(date.getDate() - 1);
                } else {
                    break;
                }
            }

            return count;
        }

        function unlockAchievement(id, message, notify = false) {
            if (!ACHIEVEMENT_DETAILS[id]) {
                return;
            }
            if (!achievements.includes(id)) {
                achievements.push(id);
                if (notify && message) {
                    alert(message);
                }
            }
        }

        function evaluateAchievements({ notify = false } = {}) {
            if (streak >= 7) {
                unlockAchievement('streak', ACHIEVEMENT_DETAILS.streak.message, notify);
            }

            const totalWorkouts = Object.keys(workoutMeta).length;
            if (totalWorkouts > 0) {
                const hasFullWeek = Object.values(weekCompletions).some(week => {
                    const workouts = Array.isArray(week.workouts) ? Array.from(new Set(week.workouts)) : [];
                    return workouts.length >= totalWorkouts;
                });
                if (hasFullWeek) {
                    unlockAchievement('week', ACHIEVEMENT_DETAILS.week.message, notify);
                }
            }

            if (level >= 10) {
                unlockAchievement('goalie', ACHIEVEMENT_DETAILS.goalie.message, notify);
            }
        }

        function updateAchievementsDisplay() {
            Object.entries(ACHIEVEMENT_DETAILS).forEach(([id, detail]) => {
                const element = document.getElementById(detail.elementId);
                if (!element) {
                    return;
                }
                if (achievements.includes(id)) {
                    element.classList.add('unlocked');
                } else {
                    element.classList.remove('unlocked');
                }
            });
        }

        function loadData() {
            const saved = localStorage.getItem('goalieApp');
            const nowWeekKey = getWeekKey(new Date());
            currentWeekKey = nowWeekKey;
            if (!saved) {
                return;
            }
            try {
                const data = JSON.parse(saved);
                exerciseData = data.exerciseData || {};
                totalXP = data.totalXP || 0;
                achievements = Array.isArray(data.achievements)
                    ? Array.from(new Set(data.achievements.filter(id => ACHIEVEMENT_DETAILS[id])))
                    : [];
                dayCompletion = data.dayCompletion || {};
                activityLog = data.activityLog || {};
                weekCompletions = data.weekCompletions || {};

                const storedWeekKey = data.currentWeekKey;
                let shouldResetWeek = false;
                if (storedWeekKey && storedWeekKey !== nowWeekKey) {
                    shouldResetWeek = true;
                } else if (!storedWeekKey) {
                    shouldResetWeek = Object.values(dayCompletion).some(info => {
                        if (!info || !info.completionDate) {
                            return false;
                        }
                        return getWeekKey(parseDateKey(info.completionDate)) !== nowWeekKey;
                    });
                }

                if (shouldResetWeek) {
                    resetForNewWeek();
                }

                currentWeekKey = nowWeekKey;
            } catch (error) {
                console.error('Failed to parse saved data', error);
            }
        }

        function saveData() {
            const data = {
                exerciseData,
                totalXP,
                achievements,
                dayCompletion,
                activityLog,
                weekCompletions,
                currentWeekKey
            };
            localStorage.setItem('goalieApp', JSON.stringify(data));
        }

        function restoreExerciseStates() {
            Object.keys(exerciseData).forEach(key => {
                if (!exerciseData[key]) {
                    return;
                }
                const [day, index] = key.split('-');
                const position = parseInt(index, 10);
                if (Number.isNaN(position)) {
                    return;
                }
                const exerciseElement = document.querySelector(`#exercises-${day} .exercise-item:nth-child(${position + 1})`);
                if (!exerciseElement) {
                    return;
                }
                const checkbox = exerciseElement.querySelector('.exercise-checkbox');
                exerciseElement.classList.add('completed');
                if (checkbox) {
                    checkbox.textContent = '‚úì';
                    checkbox.style.background = '#10b981';
                }
            });
        }

        function rebuildLogsFromDayCompletion() {
            Object.keys(dayCompletion).forEach(day => {
                const info = dayCompletion[day];
                if (!info || !info.isComplete) {
                    return;
                }
                const dateKey = info.completionDate || getTodayKey();
                dayCompletion[day].completionDate = dateKey;
                addDayToLogs(day, dateKey);
            });
        }

        function resetForNewWeek(options = {}) {
            exerciseData = {};
            dayCompletion = {};

            if (options.resetUI) {
                document.querySelectorAll('.exercise-list').forEach(list => {
                    list.querySelectorAll('.exercise-item').forEach((item, index) => {
                        item.classList.remove('completed');
                        const checkbox = item.querySelector('.exercise-checkbox');
                        if (checkbox) {
                            checkbox.textContent = index + 1;
                            checkbox.style.background = '#9ca3af';
                        }
                    });
                });
            }
        }

        function toggleWorkout(day) {
            const exercises = document.getElementById(`exercises-${day}`);
            const card = document.querySelector(`[data-day="${day}"]`);
            if (!exercises || !card) {
                return;
            }

            document.querySelectorAll('.exercise-list').forEach(list => {
                if (list.id !== `exercises-${day}`) {
                    list.classList.remove('show');
                }
            });
            document.querySelectorAll('.workout-card').forEach(c => {
                if (c !== card) {
                    c.classList.remove('active');
                }
            });

            exercises.classList.toggle('show');
            card.classList.toggle('active');
        }

        function updateWorkoutProgress(day) {
            const meta = workoutMeta[day];
            if (!meta) {
                return;
            }
            const { totalExercises } = meta;
            let completed = 0;
            let earnedXP = 0;

            for (let i = 0; i < totalExercises; i++) {
                if (exerciseData[`${day}-${i}`]) {
                    completed += 1;
                    const exerciseElement = document.querySelector(`#exercises-${day} .exercise-item:nth-child(${i + 1})`);
                    if (exerciseElement) {
                        const xpElement = exerciseElement.querySelector('.exercise-xp');
                        const xpValue = xpElement ? parseInt(xpElement.textContent, 10) : 0;
                        earnedXP += isNaN(xpValue) ? 0 : xpValue;
                    }
                }
            }

            const percentage = totalExercises > 0 ? (completed / totalExercises) * 100 : 0;
            const progressFill = document.getElementById(`progress-${day}`);
            if (progressFill) {
                progressFill.style.width = `${percentage}%`;
            }

            const completionText = document.getElementById(`completion-${day}`);
            if (completionText) {
                completionText.textContent = `${Math.round(percentage)}% Complete (${completed}/${totalExercises} exercises)`;
            }

            const xpText = document.getElementById(`xp-${day}`);
            if (xpText) {
                xpText.textContent = earnedXP;
            }

            const isComplete = totalExercises > 0 && completed === totalExercises;
            syncDayCompletion(day, isComplete);
        }

        function updateDisplay() {
            level = Math.floor(totalXP / 500) + 1;
            const xpIntoCurrentLevel = totalXP % 500;
            const xpToNext = xpIntoCurrentLevel === 0 ? (totalXP === 0 ? 500 : 0) : 500 - xpIntoCurrentLevel;

            const badge = document.getElementById('levelBadge');
            if (badge) {
                badge.textContent = `Level ${level}`;
            }

            const xpLabel = document.getElementById('xpProgress');
            if (xpLabel) {
                xpLabel.textContent = `${totalXP} XP (${xpToNext} to next level)`;
            }

            Object.keys(workoutMeta).forEach(day => updateWorkoutProgress(day));

            streak = computeStreak();
            const streakLabel = document.getElementById('streakCount');
            if (streakLabel) {
                streakLabel.textContent = streak;
            }

            const exerciseLabel = document.getElementById('exerciseCount');
            if (exerciseLabel) {
                exerciseLabel.textContent = Object.values(exerciseData).filter(Boolean).length;
            }
        }

        function refreshAppState(options = {}) {
            const weekKeyToday = getWeekKey(new Date());
            if (currentWeekKey !== weekKeyToday) {
                resetForNewWeek({ resetUI: true });
                currentWeekKey = weekKeyToday;
                delete weekCompletions[weekKeyToday];
            }

            updateDisplay();
            evaluateAchievements({ notify: options.notifyAchievements });
            updateAchievementsDisplay();

            const achievementLabel = document.getElementById('achievementCount');
            if (achievementLabel) {
                achievementLabel.textContent = achievements.length;
            }

            saveData();
        }

        function toggleExercise(day, index) {
            const key = `${day}-${index}`;
            const exerciseElement = document.querySelector(`#exercises-${day} .exercise-item:nth-child(${index + 1})`);
            if (!exerciseElement) {
                return;
            }
            const checkbox = exerciseElement.querySelector('.exercise-checkbox');

            if (exerciseData[key]) {
                exerciseData[key] = false;
                exerciseElement.classList.remove('completed');
                if (checkbox) {
                    checkbox.textContent = index + 1;
                    checkbox.style.background = '#9ca3af';
                }

                const xpElement = exerciseElement.querySelector('.exercise-xp');
                const xpValue = xpElement ? parseInt(xpElement.textContent, 10) : 0;
                if (!Number.isNaN(xpValue)) {
                    totalXP = Math.max(0, totalXP - xpValue);
                }
            } else {
                exerciseData[key] = true;
                exerciseElement.classList.add('completed');
                if (checkbox) {
                    checkbox.textContent = '‚úì';
                    checkbox.style.background = '#10b981';
                }

                const xpElement = exerciseElement.querySelector('.exercise-xp');
                const xpValue = xpElement ? parseInt(xpElement.textContent, 10) : 0;
                if (!Number.isNaN(xpValue)) {
                    totalXP += xpValue;
                }

                const completedExercises = Object.values(exerciseData).filter(Boolean).length;
                if (!achievements.includes('first') && completedExercises === 1) {
                    unlockAchievement('first', ACHIEVEMENT_DETAILS.first.message, true);
                }
            }

            refreshAppState({ notifyAchievements: true });
        }

        document.addEventListener('DOMContentLoaded', function() {
            initializeWorkoutMeta();
            loadData();
            restoreExerciseStates();
            rebuildLogsFromDayCompletion();
            refreshAppState();
        });
    </script>

</body>
</html>
